syntax = 'proto3';

import "components.proto";

package alpha.protort.protocol.deploy;

message NodeInfo
{
    string name = 1;
    string address = 2;
    uint32 port = 3;
}

message NodeInfoList
{
    repeated NodeInfo node_info = 1;
}

message Instance
{
    string name = 1;
    ComponentKind kind = 2;
}

message InstanceList
{
    repeated Instance instance = 1;
}

message Map
{
    string node_name = 1;
    string instance_name = 2;
}

message MapList
{
    repeated Map map = 1;
}

message Connection
{
    ComponentEndpoint source = 1;
    ComponentEndpoint destination = 2;
}

message ConnectionList
{
    repeated Connection connection = 1;
}

enum PacketKind
{
    DeployConfig = 0;   //деплой конфигурации
    Start = 1;          //старт ноды: старт роутера и компонентов
    Stop = 2;           //остановка ноды:
    GetNodeStatus = 3;  //запрос на статус ноды
    Update = 4;         //обновить схему развёрывания на лету
    GetConfig = 5;
}

message Config
{
    NodeInfo this_node_info = 1;
    NodeInfoList node_infos = 2;
    InstanceList instances = 3;
    MapList maps = 4;
    ConnectionList connections = 5;
}

message DeployConfigRequest
{
    Config config = 1;
}

message DeployConfigResponse
{}

message StatusRequest
{}

message StatusResponse
{
    uint32 amoung_packets = 1;
}

message StartRequest
{}

message StartResponse
{}

message StopRequest
{}

message StopResponse
{}

message GetConfigRequest
{}

message GetConfigResponse
{
    Config config = 1;
}

message Packet
{
    PacketKind packet_kind = 1;

    message Request
    {
        oneof Payload
        {
            DeployConfigRequest deploy_config_request = 1;
            StatusRequest status_request = 2;
            StartRequest start_request = 3;
            StopRequest stop_request = 4;
            GetConfigRequest get_config_request = 5;
        }
    }

    message Response
    {
        oneof Payload
        {
            DeployConfigResponse deploy_config_response = 1;
            StatusResponse status_response = 2;
            StartResponse start_response = 3;
            StopResponse stop_response = 4;
            GetConfigResponse get_config_response = 5;
        }
    }

    oneof Payload
    {
        Request request = 2;
        Response response = 3;
    }

    message Error
    {
        string message = 1;
    }

    Error error= 4;
}
